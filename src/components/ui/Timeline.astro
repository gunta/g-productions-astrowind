---
import { Icon } from 'astro-icon/components';
import { twMerge } from 'tailwind-merge';
import type { Item } from '~/types';

export interface Props {
  items?: Array<Item>;
  classes?: Record<string, string>;
}

const { items = [], classes = {} } = Astro.props as Props;

const {
  container: containerClass = '',
  panel: panelClass = '',
  title: titleClass = '',
  description: descriptionClass = '',
  icon: iconClass = '',
} = classes;
---

<div class={twMerge('flex flex-col', containerClass)}>
  {
    items && items.length && (
      <ul class="space-y-0">
        {items.map(({ title, description, icon, classes: itemClasses = {}, link }, index = 0) => (
          <li class="group relative flex gap-4">
            {/* Timeline line */}
            <div class="flex flex-col items-center">
              {/* Icon */}
              <div class={twMerge(
                'flex items-center justify-center w-10 h-10 rounded-xl',
                'bg-accent/10 dark:bg-accent/20 text-accent',
                'group-hover:bg-accent group-hover:text-white transition-colors duration-300',
                iconClass,
                itemClasses?.icon
              )}>
                {icon && <Icon name={icon} class="w-5 h-5" />}
              </div>
              
              {/* Connector line */}
              {index !== items.length - 1 && (
                <div class="w-px flex-1 bg-zinc-200 dark:bg-zinc-700 mt-2" />
              )}
            </div>
            
            {/* Content */}
            <div class={twMerge(
              'flex-1 pb-8',
              index === items.length - 1 && 'pb-0',
              panelClass,
              itemClasses?.panel
            )}>
              {title && (
                <h3 class={twMerge(
                  'font-heading font-semibold text-lg text-ink dark:text-white',
                  'group-hover:text-accent transition-colors duration-300',
                  titleClass,
                  itemClasses?.title
                )}>
                  {link ? (
                    <a
                      href={link}
                      target="_blank"
                      rel="noopener noreferrer"
                      class="hover:underline underline-offset-2"
                    >
                      {title}
                    </a>
                  ) : (
                    title
                  )}
                </h3>
              )}
              
              {description && (
                <p 
                  class={twMerge(
                    'mt-1 text-ink-secondary dark:text-zinc-400', 
                    descriptionClass, 
                    itemClasses?.description
                  )} 
                  set:html={description} 
                />
              )}
              
              {link && (
                <p class="mt-2">
                  <a
                    href={link}
                    target="_blank"
                    rel="noopener noreferrer"
                    class="text-sm text-accent hover:underline inline-flex items-center gap-1"
                  >
                    <span>詳細を見る</span>
                    <Icon name="tabler:external-link" class="w-3 h-3" />
                  </a>
                </p>
              )}
            </div>
          </li>
        ))}
      </ul>
    )
  }
</div>
