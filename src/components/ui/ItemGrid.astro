---
import type { ItemGrid as Props } from '~/types';
import { twMerge } from 'tailwind-merge';
import Button from './Button.astro';
import { Icon } from 'astro-icon/components';

const { items = [], columns, defaultIcon = '', classes = {} } = Astro.props;

const {
  container: containerClass = '',
  panel: panelClass = '',
  title: titleClass = '',
  description: descriptionClass = '',
  icon: defaultIconClass = 'text-accent',
  action: actionClass = '',
} = classes;
---

{
  items && (
    <div
      class={twMerge(
        `grid mx-auto gap-6 md:gap-8 ${
          columns === 4
            ? 'lg:grid-cols-4 md:grid-cols-3 sm:grid-cols-2'
            : columns === 3
              ? 'lg:grid-cols-3 sm:grid-cols-2'
              : columns === 2
                ? 'sm:grid-cols-2'
                : ''
        }`,
        containerClass
      )}
    >
      {items.map(({ title, description, icon, callToAction, classes: itemClasses = {} }, index) => (
        <div 
          class="group"
          style={`animation-delay: ${index * 100}ms`}
        >
          <div class={twMerge('flex flex-col h-full', panelClass, itemClasses?.panel)}>
            {/* Icon */}
            {(icon || defaultIcon) && (
              <div class="mb-4">
                <div class={twMerge(
                  'inline-flex items-center justify-center w-12 h-12 rounded-xl',
                  'bg-accent/10 dark:bg-accent/20 group-hover:bg-accent/15 transition-colors duration-300',
                )}>
                  <Icon
                    name={icon || defaultIcon}
                    class={twMerge('w-6 h-6', defaultIconClass, itemClasses?.icon)}
                  />
                </div>
              </div>
            )}
            
            {/* Content */}
            <div class="flex-1">
              {title && (
                <h3 class={twMerge(
                  'font-heading font-semibold text-xl text-ink dark:text-white',
                  'group-hover:text-accent transition-colors duration-300',
                  titleClass, 
                  itemClasses?.title
                )}>
                  {title}
                </h3>
              )}
              
              {description && (
                <p
                  class={twMerge(
                    'mt-3 text-ink-secondary dark:text-zinc-400 leading-relaxed',
                    descriptionClass, 
                    itemClasses?.description
                  )}
                  set:html={description}
                />
              )}
            </div>
            
            {/* CTA */}
            {callToAction && (
              <div class={twMerge('mt-4 pt-4 border-t border-zinc-100 dark:border-zinc-800', actionClass, itemClasses?.actionClass)}>
                <Button variant="link" class="text-accent font-medium text-sm group/btn" {...callToAction}>
                  <span>{callToAction.text}</span>
                  <Icon name="tabler:arrow-right" class="w-4 h-4 ml-1 group-hover/btn:translate-x-1 transition-transform" />
                </Button>
              </div>
            )}
          </div>
        </div>
      ))}
    </div>
  )
}
